{% extends "admin/base.html" %}

{% block title %}Manage Events - Admin{% endblock %}

{% block admin_content %}
<div class="page-header">
    <h1 class="page-title">Manage Events</h1>
    <p class="page-subtitle">View, edit, and manage all your CTF events from here.</p>
</div>

<div class="cyber-card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">Event Inventory</h3>
        <a href="{{ url_for('admin_create_event') }}" class="admin-tab active"
            style="padding: 10px 20px; border-radius: 8px; border: none;">
            <i class='bx bx-plus'></i> New Event
        </a>
    </div>

    {% if events %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid var(--admin-border);">
                    <th
                        style="padding: 15px; text-align: left; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase;">
                        Event Name</th>
                    <th
                        style="padding: 15px; text-align: left; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase;">
                        Level</th>
                    <th
                        style="padding: 15px; text-align: left; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase;">
                        Status</th>
                    <th
                        style="padding: 15px; text-align: left; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase;">
                        Date</th>
                    <th
                        style="padding: 15px; text-align: center; color: #94a3b8; font-size: 0.8rem; text-transform: uppercase;">
                        Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                <tr style="border-bottom: 1px solid var(--admin-border); transition: background 0.2s;">
                    <td style="padding: 15px;">
                        <div style="font-weight: 600;">{{ event.name }}</div>
                        <div style="font-size: 0.75rem; color: #64748b;">ID: #{{ event.id }}</div>
                    </td>
                    <td style="padding: 15px;">
                        <span class="badge"
                            style="background: rgba(56, 189, 248, 0.1); color: var(--admin-accent); padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;">
                            {{ event.level }}
                        </span>
                    </td>
                    <td style="padding: 15px;">
                        {% set status_color = '#fbbf24' %}
                        {% if event.status == 'Live' %}{% set status_color = '#4ade80' %}{% endif %}
                        {% if event.status == 'Ended' %}{% set status_color = '#94a3b8' %}{% endif %}
                        <span
                            style="display: inline-flex; align-items: center; gap: 5px; color: {{ status_color }}; font-size: 0.85rem; font-weight: 500;">
                            <span
                                style="width: 8px; height: 8px; border-radius: 50%; background: {{ status_color }};"></span>
                            {{ event.status }}
                        </span>
                    </td>
                    <td style="padding: 15px; font-size: 0.85rem; color: #cbd5e1;">
                        {{ event.date }}
                    </td>
                    <td style="padding: 15px; text-align: center;">
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <form method="POST" action="{{ url_for('admin_delete_event', event_id=event.id) }}"
                                onsubmit="return confirm('WARNING: Are you sure you want to delete this event? This will remove all associated tasks.');">
                                <button type="submit"
                                    style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); padding: 5px 10px; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <i class='bx bx-trash'></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px 20px;">
        <i class='bx bx-ghost' style="font-size: 4rem; color: #1e293b; margin-bottom: 20px; display: block;"></i>
        <h4 style="color: #94a3b8;">No events found in the database.</h4>
        <p style="color: #64748b;">Start by creating your first CTF tournament.</p>
        <a href="{{ url_for('admin_create_event') }}" class="admin-tab active"
            style="display: inline-flex; margin-top: 15px; padding: 10px 25px; border-radius: 8px;">
            Create Event
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}