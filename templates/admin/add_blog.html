{% extends "admin/base.html" %}

{% block title %}{{ "Edit" if blog else "Add" }} Blog - Admin Panel{% endblock %}

{% block admin_content %}
<div class="mb-4">
    <a href="{{ url_for('admin_blogs') }}" class="text-secondary text-decoration-none">
        <i class='bx bx-left-arrow-alt'></i> Back to Blogs
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card bg-dark border-secondary">
            <div class="card-header border-secondary bg-transparent py-3">
                <h2 class="h5 mb-0 text-white">{{ "Edit" if blog else "Create New" }} Blog Post</h2>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label class="form-label text-secondary">Blog Title</label>
                        <input type="text" name="title" class="form-control bg-transparent text-white border-secondary"
                            placeholder="e.g. Solving the 'Impossible' Buffer Overflow"
                            value="{{ blog.title if blog else '' }}" required>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-secondary">Category Tag</label>
                            <select name="category" class="form-select bg-transparent text-white border-secondary">
                                <option value="CTF Writeup" {{ 'selected' if blog and blog.category=='CTF Writeup' }}>
                                    CTF Writeup</option>
                                <option value="Web Security" {{ 'selected' if blog and blog.category=='Web Security' }}>
                                    Web Security</option>
                                <option value="Crypto" {{ 'selected' if blog and blog.category=='Crypto' }}>Crypto
                                </option>
                                <option value="Tutorial" {{ 'selected' if blog and blog.category=='Tutorial' }}>Tutorial
                                </option>
                                <option value="News" {{ 'selected' if blog and blog.category=='News' }}>News</option>
                                <option value="Reverse Eng" {{ 'selected' if blog and blog.category=='Reverse Eng' }}>
                                    Reverse Eng</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label text-secondary">Read Time (e.g. 5 min)</label>
                            <input type="text" name="read_time"
                                class="form-control bg-transparent text-white border-secondary" placeholder="5 min"
                                value="{{ blog.read_time if blog else '' }}" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label text-secondary">Short Description</label>
                        <textarea name="short_description"
                            class="form-control bg-transparent text-white border-secondary" rows="3"
                            placeholder="Brief summary of the article..."
                            required>{{ blog.short_description if blog else '' }}</textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label text-secondary">External Blog URL (Medium / Dev.to)</label>
                        <input type="url" name="external_url"
                            class="form-control bg-transparent text-white border-secondary"
                            placeholder="https://medium.com/@username/article-link"
                            value="{{ blog.external_url if blog else '' }}" required>
                    </div>

                    <div class="mb-4">
                        <label class="form-label text-secondary">Blog Thumbnail Image</label>
                        <input type="file" name="thumbnail"
                            class="form-control bg-transparent text-white border-secondary" {{ ' ' if blog
                            else 'required' }}>
                        {% if blog and blog.thumbnail %}
                        <div class="mt-2">
                            <small class="text-muted">Current thumbnail:</small><br>
                            <img src="{{ url_for('static', filename='uploads/blogs/' + blog.thumbnail) }}" alt="Current"
                                style="width: 150px; border-radius: 4px; border: 1px solid #444;">
                        </div>
                        {% endif %}
                    </div>

                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-primary py-2 font-weight-bold">
                            {{ "Update Blog" if blog else "Publish Blog" }}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control:focus,
    .form-select:focus {
        background-color: rgba(255, 255, 255, 0.05);
        border-color: var(--accent-green);
        color: white;
        box-shadow: 0 0 0 0.25rem rgba(34, 197, 94, 0.25);
    }

    option {
        background-color: #1a1a1a;
    }
</style>
{% endblock %}